name: npm publish
traits:
  - name: "notification"
    properties:
      types:
        - "dingtalk"
      when: "fail"
      callbacks: [ ]
      users: [ ]
      webhooks: [ ]
params:
  dry_run:
    name: 尝试发布(dry-run)
    description: 请首先尝试发布，查看日志不报错，再关闭尝试发布(dry-run)
    type: boolean
    default: true
jobs:
  upload:
    image: "alios-8u"
    timeout: 15m
    envs:
      dry_run: ${{params.dry_run}}
      NPM_TOKEN: ${{secrets.NPM_TOKEN}}
    steps:
      - uses: checkout
      - uses: setup-env
        inputs:
          node-version: '12'
      - run:
          - sh .aoneci/publish.sh
